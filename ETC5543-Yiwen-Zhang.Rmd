--- 
title: "What do CRAN download counts mean?"
author: "Yiwen Zhang"
date: "`r Sys.Date()`"
documentclass: book
site: bookdown::bookdown_site
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: Yiwen-Zhang-259/ETC5543-cran-analysis
description: ""
---

# Preface {-}

This is written as part of the ETC5543 research project supervised by Drs Emi Tanaka and Hien Nguyen.

```{r, include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```




<!--chapter:end:index.Rmd-->

# Abstract

Data is closely related to social and economic activities and our daily life, so data mining and analysis will definitely benefit us. In many statistical and data analysis tools, we focus on R in this project, and aim to explore the evolution of R packages. By obtaining the daily and recent half year total download count of 17700 R packages (up to 2021-06-07) and R itself, we analyze their pattern characteristics, as well as the relationship between the release date, update times, number of commits on Github, name length and alphabetic order of the packages. Finally, we also check the changes of the top 15 downloaded packages on 1st April from 2013 to 2021, to have a glance of how the user preferences changes to some extent.

\pagebreak

# Introduction {#intro}

Data, which has penetrated into every industry and business field, has become an increasingly important production factor and is closely related to our life.  For example, every day, before getting up, you may pick up your smart phone and check the weather forecast based on comprehensive analysis of various data, so as to decide today's dress and schedule. Another example is, when you are shopping on the website, you may probably find that the products recommended by big data algorithm always coincide with what you exactly want recently. Obviously, the digitalization of information makes our life easier and more convenient.

However, as we know, the data itself is not of great significance, because it is quite hard for us to obtain direct and effective information from simple numbers or other kinds of raw data before processing, that is to say, what really matters is the information hidden behind the data. In other words, data is only a carrier, only after processing and calculation, we can dig out the "information" behind it. Therefore, many statistical tools were born, such as C, Java and Python. In this project, we only focus on one of them : R language. 

R is an increasing popular statistical language with stably around top 10 ranking in TIOBE Index[@tiobe]. In the process of using R, it often need the help of R packages to extend its functions. Due to that, R packages have become an indispensable part for R users. Although there are many sources to install R packages such as Bioconductor, Gitlab or R-Forge, we only focus on CRAN (The Comprehensive R Archive Network), which is the official R packages repository. And there are quite a lot CRAN mirrors for the convenient for people from different regions, but we only focus on CRAN in Australia. And So far (up to 2021-06-07), there have been 17700 R packages on CRAN.

Based on that, researchers have started to study the popularity of R packages from CRAN. The most intuitive embodiment of popularity is the total number of downloads, although it does not directly reflect the number of users, because it includes the same user's repeated downloads, updates and test downloads caused by the server. But we still assume in this project that, the download amount is a relatively reliable and simple measure of packages' popularity. Back to the previous studies, the R-package `adjustedcranlogs`[@adjustedcranlogs] finds that there are spike in downloads due to automatic re-downloads and package update, and it also provides a method to remove these download logs. And package `packageRank`[@packageRank] provides a way to compute the rank percentile for packages and filter the invalid downloads including small and medium size logs. What's more, there are also some packages such as `pkgsearch`[@pkgsearch] and `Visualize.CRAN.Downloads`[@Visualize.CRAN.Downloads] providing some visualization methods to explore the package download trend or for convenient searching. Some of them are function extensions based on previous packages, and some of them  propose their own new functions, but generally speaking, they are inclined to be more tool like to help users explore the characteristics of package download logs from as many dimensions as possible. 

As for us, the purpose of this project is to explore the download logs of R packages on CRAN and analyze the relationship between some influential factors with it to help users and developers better understand the download amount pattern and also figure out what would determine a package's popularity to some extent. There are some terms involved in this project :

- R language : R is a language and environment for statistical computing and graphics which can be extended easily via packages and provide an Open Source route to participation in statistical methodology. It is available as Free Software under the term of the Free Software Foundationâ€™s GNU General Public License [@gnu].

- R Studio : It is an integrated development environment (IDE) for R. It includes a console, syntax-highlighting editor that supports direct code execution, as well as tools for plotting, history, debugging and workspace management.[@rstudio]

- R Packages : They are collections of functions and data sets developed by the community. They increase the power of R by improving existing base R functionalities, or by adding new ones.

- CRAN : It is a network of ftp and web servers around the world that store identical, up-to-date, versions of code and documentation for R.[@CRAN]

- CRAN mirror : It is a website containing differently located servers, which aims to facilitate people from different regions and countries to access CRAN more smoothly and quickly. And each server is called a mirror.[@cranmirror]

- Github API : It is the abbreviation of Application Programming Interface, which is a software intermediary that allows two applications to talk to each other. 

- CRAN task view : It aims to provide some guidance which packages on CRAN are relevant for tasks related to a certain topic [@crantaskviews].

<!--chapter:end:01-intro.Rmd-->

# Methods

In this project, we extracted R packages names from CRAN and got summary daily download logs of R packages through web API maintained by r-hub[@rhub]. And we also collected release dates of R packages through CRAN. In addition, we also tried to scrap the number of commits in Github repository for R packages. However, due to the rate limit of Github API, we only captured part of the data in the end. Then we constructed eight exploratory data analysis sections: 

- a) we explored the daily download of all the packages on CRAN and figured out the number of packages occupied by different downloaded groups; 

- b) we analyzed the daily download trend of R itself and the found out the most popular version of R; 

- c) we compared the top 15 downloaded packages on CRAN on 1st April. from year 2013 to 2021 to see how the user preference changes;

- d) we figured out the relationship between initial release date and the total download count for last half a year; 

- e) we compared two closely related packages `fable` and `forecast` to see the difference between their MA (moving average); 

- f) we studied how the number of commits of master (main) branch on Github repository influence the total download count for last half a year; 

- g) we explored the relationship between the number of updates of packages and its download count; 

- h) we analyzed the name length pattern for both CRAN task view packages and all the packages on CRAN; 

- i) we explored how the alphabetical order of packages affected the download count and its statistic features (variance, median).

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      cache = TRUE,
                      cache.path = paste0("cache/",
                                          ifelse(knitr::is_html_output(), "html/", "latex/")),
                      fig.path = "figures/",
                      fig.align = "center",
                      message = FALSE,
                      warning = FALSE)
 library(tidyverse)
 library(cranlogs)
 library(glue)
 library(grid)
 library(pkgsearch)
 library(ctv)
 library(lubridate)
 library(jsonlite)
 library(htmltools)
 library(httpuv)
 library(httr)
 library(kableExtra)
 library(packageRank)
 library(fpp3)
 library(slider)
 library(rvest)
 library(rlist)
 library(available)
 library(xml2)
 library(stats)
 library(gglorenz)
 library(yaml)

theme_set(theme_bw(base_size = 14) +
            theme(plot.title.position = "plot"))

# comment out below to include/exclude analysis
child_docs <- c(
                "02-S01-pkg-downloads.Rmd",
                #"02-S01B-R-downloads.Rmd",
                #"02-S02-top15.Rmd",
                #"02-S03-release-date.Rmd",
                #"02-S04-similarpkg-fable-forecast.Rmd",
                #"02-S05-github-commits.Rmd",
                #"02-S06-update-times.Rmd",
                #"02-S07-pkg-name-length.Rmd",
                #"02-S08-pkg-name-order.Rmd",
                NULL)
```

```{r child=child_docs}
```

<!--chapter:end:02-analysis.Rmd-->

# Summary

In this project, we collected summary daily download logs of R packages through web API maintained by r-hub[@rhub] and also used daily download data in CRAN for a time period from 2013-04-01 to 2021-04-01 to explore the daily download pattern of all packages both in general and of each year. In that case, we found that it is true that the cumulative number of downloads increases with time, and the variance also increases, which indicates that some packages with larger downloads grow rapidly. In addition, there is also strong weekly seasonality in the daily download plot. The download count will peak through weekdays and drop on weekend, for users may tend to work and study during weekdays while rest on weekends. What's more, through Lorenz curve, we also found that most of the cumulative downloads came from the top 10% downloaded packages, so we could also see that the distribution of downloads is quite unequal. Part of the reason is that these top 10% downloaded packages contain quite a lot popular and frequently used packages, such as `tidyverse` and `rlang`, which would be more probably to gain high downloads. In addition, there are other packages that often get high download volume, which can be divided into the following four categories:

- Packages maintained by R studio
- Packages created by authors from R core group
- Packages created by authors from R secondary group
- Packages created by R related authors
- Packages created by top 20 prolific maintainers (This is resourced at @revolutions)

However, the existence of these packages may make it difficult to reflect the popularity of other packages, we excluded these packages for the analysis of user preferences. And we found that the topic of newly added packages on 1st Oct of each year come from quite different areas, while the packages remaining most stably popular during 2017 to 2019 is about JAVA dependency. Definitely, JAVA always ranked the top three among programming languages according to TIOBE Index[@tiobe], which shows that the number of users under JAVA related packages would be probably huge.

As for R itself, its download pattern is quite similar to that of total R packages on CRAN. And the most used OS for R users is windows OS. Also, the most popular version of R is 3.2.1.

After exploration of the characteristics of download pattern for R package and R itself, we then extracted the release dates of all packages and taskview packages from CRAN to compare the total download count of last half a year among packages with different release date or with different numbers of updates. And we found that for packages from the same topic, earlier release date usually would bring more download count, while packages with more times of updates would not always have higher downloads. So to sum up, packages released earlier and kept updated are more likely to have higher downloads. 

In the next section, we initially tried to scrape the number of commits in Github repository of all packages on CRAN through Github API by R, to check whether more commits would result in more downloads or not. But there came a tricky problem on the rate limit of Github API. As documented in @githubapi, unauthenticated users could only be permitted to send 60 requests per hour. And only after get authentication, could the rate limit be expanded up to 5000 per hour. However, after trying several methods to get authentication, the rate limit was failed increase. So, we switched to make this done with python by setting random agent to avoid the API limit.Meanwhile, in order to display our initial research idea, we still had a look at the last 1% downloaded packages on this question with the original method, and that is also adapted as well. Therefore, we would expect that generally, if a package has more commits on Github repository, it would probably gain more download count.

The last two parts are about analysis for package name. We compared the average downloads among packages with different name length and different alphabetical orders. It is believed that over half of the packages tend to have shorter names probably for the sake of being easily remembered by users. And alphabetical order played little roles in promoting the download volume.


# Conclusion

In conclusion, we hold the belief that there are many factors that affect the download amount and popularity of the R packages on CRAN, such as the popularity of the creator, the application field of the package, the release date, whether to keep updated, and the length of the name. In addition, we also assume that the number of commits on Github repository will also probably affect the download amount of packages. However, due to technical limitations, the sample size we got is too small to make a strong conclusion on this point. We hope that in the future, we can get over this difficulty and add supplement. Anyway, we could generally believed that a relatively popular package should have earlier release date, shorter name and maybe more commits on Github repository if they have. There is also another point that could not be ignored is to keep updated. 


<!--chapter:end:03-summary.Rmd-->

`r if (knitr:::is_html_output()) '
# References {-}
'`

<!--chapter:end:04-references.Rmd-->

